# .github/workflows/test-crawler.yml
# çˆ¬è™«æµ‹è¯•å·¥ä½œæµ

name: Test Homework Crawler

# è§¦å‘æ¡ä»¶ï¼šä»£ç æŽ¨é€æˆ–Pull Requestæ—¶
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test-crawler:
    runs-on: ubuntu-latest
    
    steps:
    # æ­¥éª¤1: æ£€å‡ºä»£ç 
    - name: Checkout repository
      uses: actions/checkout@v4
      
    # æ­¥éª¤2: è®¾ç½®PythonçŽ¯å¢ƒ
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    # æ­¥éª¤3: å®‰è£…ä¾èµ–
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f "requirements.txt" ]; then
          pip install -r requirements.txt
        else
          pip install requests beautifulsoup4 pandas openpyxl colorama
        fi
        
    # æ­¥éª¤4: æ£€æŸ¥è¯­æ³•å’Œå¯¼å…¥
    - name: Check syntax and imports
      run: |
        python -m py_compile homework_crawler.py  # ç¼–è¯‘æ£€æŸ¥Pythonè¯­æ³•
        echo "âœ… è¯­æ³•æ£€æŸ¥é€šè¿‡"
        
    # æ­¥éª¤5: éªŒè¯æ–‡ä»¶ç»“æž„
    - name: Verify file structure
      run: |
        echo "æ£€æŸ¥é¡¹ç›®æ–‡ä»¶ç»“æž„..."
        
        # æ£€æŸ¥ä¸»è¦æ–‡ä»¶
        [ -f "homework_crawler.py" ] && echo "âœ… homework_crawler.py å­˜åœ¨" || echo "âŒ homework_crawler.py ä¸å­˜åœ¨"
        [ -f "index.html" ] && echo "âœ… index.html å­˜åœ¨" || echo "âŒ index.html ä¸å­˜åœ¨"
        [ -f "css/style.css" ] && echo "âœ… css/style.css å­˜åœ¨" || echo "âŒ css/style.css ä¸å­˜åœ¨"
        [ -f "css/responsive.css" ] && echo "âœ… css/responsive.css å­˜åœ¨" || echo "âŒ css/responsive.css ä¸å­˜åœ¨"
        
        # æ£€æŸ¥ JS æ–‡ä»¶
        JS_FILES=("main.js" "dataLoader.js" "filter.js" "tableRenderer.js" "statistics.js")
        for js_file in "${JS_FILES[@]}"; do
          [ -f "js/$js_file" ] && echo "âœ… js/$js_file å­˜åœ¨" || echo "âŒ js/$js_file ä¸å­˜åœ¨"
        done
        
    # æ­¥éª¤6: æµ‹è¯•çˆ¬è™«åŠŸèƒ½ï¼ˆåŸºç¡€æµ‹è¯•ï¼‰
    - name: Test crawler functionality
      run: |
        echo "æµ‹è¯•çˆ¬è™«åŠŸèƒ½..."
        # æµ‹è¯•çˆ¬è™«çš„å¸®åŠ©åŠŸèƒ½ï¼ˆä¸æ¶‰åŠå®žé™…ç™»å½•ï¼‰
        python homework_crawler.py --help && echo "âœ… å¸®åŠ©å‘½ä»¤æ­£å¸¸" || echo "âš ï¸ å¸®åŠ©å‘½ä»¤å¼‚å¸¸"
        
    # æ­¥éª¤7: åˆ›å»ºæµ‹è¯•æŠ¥å‘Šï¼ˆå§‹ç»ˆæ‰§è¡Œï¼‰
    - name: Create test report
      if: always()
      run: |
        echo "# çˆ¬è™«æµ‹è¯•æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**æµ‹è¯•æ—¶é—´:** $(date)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… è¯­æ³•æ£€æŸ¥é€šè¿‡" >> $GITHUB_STEP_SUMMARY
        echo "âœ… ä¾èµ–å®‰è£…æˆåŠŸ" >> $GITHUB_STEP_SUMMARY  
        echo "âœ… æ–‡ä»¶ç»“æž„æ£€æŸ¥å®Œæˆ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“ **è¯´æ˜Ž:** å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•éœ€è¦æœ‰æ•ˆçš„é—¨æˆ·ç½‘ç«™è´¦å·" >> $GITHUB_STEP_SUMMARY
